# --- Lovelace View Configuration ---
# Add this structure to your Lovelace dashboard configuration (e.g., ui-lovelace.yaml or Raw Editor)

title: LED Truss Control
path: led-truss
icon: mdi:string-lights
panel: false
cards:
  - type: vertical-stack
    cards:
      # --- Effect Selection --- (Top Card)
      - type: entities
        title: Effect Selection
        show_header_toggle: false
        entities:
          - input_select.led_effect

      # --- Optional Color Mode Toggles ---
      # Only shown when relevant effect is selected
      - type: conditional
        conditions:
          - condition: or # Show this card if ANY of the effects needing a toggle are selected
            conditions:
              - condition: state
                entity: input_select.led_effect
                state: sparkle
              - condition: state
                entity: input_select.led_effect
                state: theater_chase
              - condition: state
                entity: input_select.led_effect
                state: set_color
        card:
          type: entities
          # title: Optional Color Mode # Optional title
          show_header_toggle: false
          entities:
            - type: conditional # Only show if sparkle is selected
              conditions:
                - condition: state
                  entity: input_select.led_effect
                  state: sparkle
              row:
                entity: input_boolean.led_sparkle_use_multicolor
            - type: conditional # Only show if theater_chase is selected
              conditions:
                - condition: state
                  entity: input_select.led_effect
                  state: theater_chase
              row:
                entity: input_boolean.led_theater_chase_use_rainbow
            - type: conditional # Only show if set_color is selected
              conditions:
                - condition: state
                  entity: input_select.led_effect
                  state: set_color
              row:
                entity: input_boolean.led_set_color_use_white

      # --- Main Color Picker (Conditional) --- Using light-entity-card
      - type: conditional
        conditions:
          # ALL of these top-level conditions must be true (default AND)
          - condition: state
            entity: input_select.led_effect
            state_not: bitcoin
          - condition: state
            entity: input_select.led_effect
            state_not: color_fade # Uses specific from/to colors
          - condition: state
            entity: input_select.led_effect
            state_not: rainbow
          - condition: state
            entity: input_select.led_effect
            state_not: rainbow_cycle
          - condition: state
            entity: input_select.led_effect
            state_not: clear
          - condition: state
            entity: input_select.led_effect
            state_not: set_brightness
          # AND one of the following OR groups must be true (Handles optional toggles)
          - condition: or
            conditions:
              - condition: state
                entity: input_select.led_effect
                state_not: sparkle
              - condition: state # If sparkle IS selected, multicolor toggle must be OFF
                entity: input_boolean.led_sparkle_use_multicolor
                state: 'off'
          - condition: or
            conditions:
              - condition: state
                entity: input_select.led_effect
                state_not: theater_chase
              - condition: state # If theater_chase IS selected, rainbow toggle must be OFF
                entity: input_boolean.led_theater_chase_use_rainbow
                state: 'off'
          - condition: or
            conditions:
              - condition: state
                entity: input_select.led_effect
                state_not: set_color
              - condition: state # If set_color IS selected, white toggle must be OFF
                entity: input_boolean.led_set_color_use_white
                state: 'off'
        card:
          type: custom:light-entity-card
          entity: light.led_truss_color_picker
          # Use header outside the main entity display
          header: Select Color
          # --- Key changes based on documentation ---
          hide_header: true        # Hides the default header AND the toggle switch
          brightness: false        # Explicitly disable brightness slider
          color_temp: false        # Explicitly disable color temp slider
          white_value: false       # Explicitly disable white value slider
          color_picker: true       # Ensure color picker is enabled (default, but good to be explicit)
          show_effect: false       # Hide effects list
          # --- Layout options (keep or adjust as needed) ---
          full_width_controls: true # Makes controls like the picker potentially wider
          persist_features: true # Try setting to false or removing, might help ensure controls are hidden

      # --- Effect Specific Parameters (Each in its own conditional card) ---

      - type: conditional
        conditions:
          - condition: state # Added explicit condition state
            entity: input_select.led_effect
            state: bitcoin
        card:
          type: entities
          title: Bitcoin Options
          show_header_toggle: false
          entities:
            - input_number.led_duration
            - input_number.led_time_threshold_in_secs

      - type: conditional
        conditions:
          - condition: state # Added explicit condition state
            entity: input_select.led_effect
            state: color_fade
        card:
          type: entities
          title: Color Fade Options
          show_header_toggle: false
          entities:
            - input_number.led_color_from_r
            - input_number.led_color_from_g
            - input_number.led_color_from_b
            - input_number.led_color_to_r
            - input_number.led_color_to_g
            - input_number.led_color_to_b
            - input_number.led_steps
            - input_number.led_wait_ms

      - type: conditional
        conditions:
          - condition: state # Added explicit condition state
            entity: input_select.led_effect
            state: glow
        card:
          type: entities
          title: Glow Options
          show_header_toggle: false
          entities:
            - input_number.led_frames
            - input_number.led_wait_ms

      - type: conditional
        conditions:
          - condition: state # Added explicit condition state
            entity: input_select.led_effect
            state: wave
        card:
          type: entities
          title: Wave Options
          show_header_toggle: false
          entities:
            - input_number.led_frames
            - input_number.led_cycles
            - input_number.led_speed
            - input_number.led_wait_ms

      - type: conditional
        conditions:
          - condition: state # Added explicit condition state
            entity: input_select.led_effect
            state: color_wipe
        card:
          type: entities
          title: Color Wipe Options
          show_header_toggle: false
          entities:
            - input_number.led_wait_ms

      - type: conditional
        conditions:
          - condition: state # Added explicit condition state
            entity: input_select.led_effect
            state: sparkle
        card:
          type: entities
          title: Sparkle Options
          show_header_toggle: false
          entities:
            # Color toggle/sliders handled above
            - input_number.led_wait_ms
            - input_boolean.led_cummulative

      - type: conditional
        conditions:
          - condition: state # Added explicit condition state
            entity: input_select.led_effect
            state: rainbow
        card:
          type: entities
          title: Rainbow Options
          show_header_toggle: false
          entities:
            - input_number.led_wait_ms
            - input_number.led_iterations

      - type: conditional
        conditions:
          - condition: state # Added explicit condition state
            entity: input_select.led_effect
            state: rainbow_cycle
        card:
          type: entities
          title: Rainbow Cycle Options
          show_header_toggle: false
          entities:
            - input_number.led_wait_ms
            - input_number.led_iterations

      - type: conditional
        conditions:
          - condition: state # Added explicit condition state
            entity: input_select.led_effect
            state: theater_chase
        card:
          type: entities
          title: Theater Chase Options
          show_header_toggle: false
          entities:
            # Color toggle/sliders handled above
            - input_number.led_wait_ms
            - input_number.led_iterations

      - type: conditional
        conditions:
          - condition: state # Added explicit condition state
            entity: input_select.led_effect
            state: running
        card:
          type: entities
          title: Running Options
          show_header_toggle: false
          entities:
            - input_number.led_wait_ms
            - input_number.led_duration_ms
            - input_number.led_width

      - type: conditional
        conditions:
          - condition: state # Added explicit condition state
            entity: input_select.led_effect
            state: set_brightness
        card:
          type: entities
          title: Brightness Control
          show_header_toggle: false
          entities:
            - input_number.led_brightness

      - type: conditional
        conditions:
          - condition: state # Added explicit condition state
            entity: input_select.led_effect
            state: set_color_range_percent
        card:
          type: entities
          title: Set Color Range (%)
          show_header_toggle: false
          entities:
            # Color sliders handled above
            - input_number.led_start_percent
            - input_number.led_end_percent

      - type: conditional
        conditions:
          - condition: state # Added explicit condition state
            entity: input_select.led_effect
            state: set_color_range_exact
        card:
          type: entities
          title: Set Color Range (Index)
          show_header_toggle: false
          entities:
            # Color sliders handled above
            - input_number.led_start_index
            - input_number.led_end_index

      # --- Action Button --- (Bottom Card)
      - type: button
        tap_action:
          action: call-service
          service: script.run_led_effect
        name: Run Effect
        icon: mdi:send

# --- End of view configuration --- 